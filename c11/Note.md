# 第11章 进入保护模式
操作系统管理着整个计算机的软件和硬件，它做任何事情都是可以的。但是用户程序应当有所限制，只允许用户程序访问自己的数据，即便是跳转也只能够在自己的各个代码段之间跳转。

但是，在实模式下，用户程序对内存的访问是十分自由的。没有任何限制，随随便便就能够修改任何一个内存单元。

在多用户、多任务时代，内存中会同时存在多个用户程序。为了使它们彼此隔离，防止因某个程序的编写错误或者崩溃而影响到操作系统和其他用户程序，使用保护模式是非常有必要的。

## 11.1 代码清单11-1

## 11.2 全局描述符表
为了让用户程序能够在内存中自由的浮动而又不影响到它的执行，处理器将内存划分为逻辑上的段，并在指令中使用段内偏移地址。在保护模式下同样也是使用段地址和偏移地址。只不过在使用一个段之前必须提前登记。

和一个段有关的信息需要8个字节来描述，所以叫做段描述符，每个段都有一个描述符，将这些描述符存放在一起就形成了一张段描述符表。

最为重要的描述符表为全局描述符表(Global Descriptor Table, GDT),所谓全局，意味着该表为整个软硬件服务。**在进入保护模式之前必须定义全局描述符表**。

在处理器内部，有一个48位的寄存器，叫做全局描述符表寄存器(GDTR)。该寄存器分为两个部分，分别是32位的线性地址和16位的边界。32位的处理器具有32根地址线，其寻址范围为 $2^{32} = 4GB$内存。所以GDTR的32位线性地址部分保存的是全局描述符表在内存中的起始线性地址，16位边界部分保存的是全局描述符表的边界，其值等于表的大小(总的字节数)减一。

因为GDT边界是16位的，所以该表最大是 $2^{16}=64KB$个字节。又因为每个描述符需要8个字节去描述，所以最多可以有8192个描述符。

需要在进入保护模式之间定义全局描述符GDT，而在实模式下，只能够寻址1MB空间，所以需要把GDT定义在1MB内存空间以内。

